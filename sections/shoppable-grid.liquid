<section class="ee-grid wrapper" data-section-id="{{ section.id }}">
  <div class="ee-grid__header">
    <h2>{{ section.settings.heading }}</h2>
  </div>

  <div class="ee-grid__items">
    {% for block in section.blocks %}
      {% assign p = all_products[block.settings.product] %}
      {% if p %}
        <article class="ee-grid__card" {{ block.shopify_attributes }}>
          <button class="ee-grid__hotspot" type="button"
                  data-product-id="{{ p.id }}"
                  aria-label="Open {{ p.title }}">
            +
          </button>
        <img 
  src="{{ block.settings.custom_image | default: p.featured_image | image_url: width: 900 }}" 
  alt="{{ block.settings.custom_image.alt | default: p.title }}" 
>

          <script type="application/json" id="ee-product-json-{{ p.id }}">
            {{ p | json }}
          </script>
        </article>
      {% endif %}
    {% endfor %}
  </div>

  <!-- Popup -->
  <div class="ee-popup" data-popup hidden>
    <div class="ee-popup__overlay" data-popup-close></div>
    <div class="ee-popup__panel" role="dialog">
      <button class="ee-popup__close" type="button" data-popup-close>&times;</button>
      <div class="ee-popup__top">
        <img class="ee-popup__thumb" data-popup-image>
        <div>
          <h3 data-popup-title></h3>
          <div data-popup-price></div>
        </div>
      </div>
      <div class="ee-popup__desc" data-popup-desc></div>
      <form class="ee-popup__form" data-variant-form>
        <div class="ee-popup__options" data-options></div>
        <button class="ee-btn ee-btn--block" type="submit" data-add-to-cart>
          <span>ADD TO CART</span>
          <svg class="ee-arrow" viewBox="0 0 24 24"><path d="M5 12h14M13 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2"/></svg>
        </button>
      </form>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "EE • Shoppable Grid (6)",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "In the Wild" },
    { "type": "product", "id": "companion_product", "label": "Companion product (auto-add)" },
    { "type": "text", "id": "trigger_color", "label": "Trigger Color", "default": "Black" },
    { "type": "text", "id": "trigger_size", "label": "Trigger Size", "default": "Medium" }
  ],
  "blocks": [
    {
      "type": "product_card",
      "name": "Product",
      "limit": 6,
      "settings": [
        { "type": "product", "id": "product", "label": "Product" },
        { "type": "image_picker", "id": "custom_image", "label": "Custom image (optional)" }
      ]
    }
  ],
  "presets": [{ "name": "EE • Shoppable Grid (6)" }]
}
{% endschema %}
